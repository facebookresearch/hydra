"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2511],{15680:(e,n,a)=>{a.r(n),a.d(n,{MDXContext:()=>d,MDXProvider:()=>p,mdx:()=>g,useMDXComponents:()=>m,withMDXComponents:()=>s});var l=a(96540);function t(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function o(){return o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},o.apply(this,arguments)}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,l)}return a}function i(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){t(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function c(e,n){if(null==e)return{};var a,l,t=function(e,n){if(null==e)return{};var a,l,t={},o=Object.keys(e);for(l=0;l<o.length;l++)a=o[l],n.indexOf(a)>=0||(t[a]=e[a]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)a=o[l],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(t[a]=e[a])}return t}var d=l.createContext({}),s=function(e){return function(n){var a=m(n.components);return l.createElement(e,o({},n,{components:a}))}},m=function(e){var n=l.useContext(d),a=n;return e&&(a="function"==typeof e?e(n):i(i({},n),e)),a},p=function(e){var n=m(e.components);return l.createElement(d.Provider,{value:n},e.children)},u="mdxType",f={inlineCode:"code",wrapper:function(e){var n=e.children;return l.createElement(l.Fragment,{},n)}},b=l.forwardRef((function(e,n){var a=e.components,t=e.mdxType,o=e.originalType,r=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),s=m(a),p=t,u=s["".concat(r,".").concat(p)]||s[p]||f[p]||o;return a?l.createElement(u,i(i({ref:n},d),{},{components:a})):l.createElement(u,i({ref:n},d))}));function g(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=a.length,r=new Array(o);r[0]=b;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i[u]="string"==typeof e?e:t,r[1]=i;for(var d=2;d<o;d++)r[d]=a[d];return l.createElement.apply(null,r)}return l.createElement.apply(null,a)}b.displayName="MDXCreateElement"},49595:(e,n,a)=>{a.d(n,{A:()=>d,C:()=>s});var l=a(58168),t=a(96540),o=a(75489),r=a(44586),i=a(48295);function c(e){const n=(0,i.ir)();return(0,r.default)().siteConfig.customFields.githubLinkVersionToBaseUrl[n?.name??"current"]+e}function d(e){return t.createElement(o.default,(0,l.A)({},e,{to:c(e.to),target:"_blank"}))}function s(e){const n=e.text??"Example (Click Here)";return t.createElement(d,e,t.createElement("span",null,"\xa0"),t.createElement("img",{src:"https://img.shields.io/badge/-"+n+"-informational",alt:"Example (Click Here)"}))}},49833:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>c,toc:()=>s});var l=a(58168),t=(a(96540),a(15680)),o=a(49595);const r={id:"callbacks",title:"Callbacks",sidebar_label:"Callbacks"},i=void 0,c={unversionedId:"experimental/callbacks",id:"experimental/callbacks",title:"Callbacks",description:"The Callback interface enables custom",source:"@site/docs/experimental/callbacks.md",sourceDirName:"experimental",slug:"/experimental/callbacks",permalink:"/docs/experimental/callbacks",draft:!1,editUrl:"https://github.com/facebookresearch/hydra/edit/main/website/docs/experimental/callbacks.md",tags:[],version:"current",lastUpdatedBy:"jesszzzz",lastUpdatedAt:1754324926,formattedLastUpdatedAt:"Aug 4, 2025",frontMatter:{id:"callbacks",title:"Callbacks",sidebar_label:"Callbacks"},sidebar:"docs",previous:{title:"Introduction",permalink:"/docs/experimental/intro"},next:{title:"Re-run",permalink:"/docs/experimental/rerun"}},d={},s=[{value:"Configure Callback",id:"configure-callback",level:3},{value:"Callback ordering",id:"callback-ordering",level:3},{value:"Example callbacks",id:"example-callbacks",level:3}],m={toc:s},p="wrapper";function u(e){let{components:n,...a}=e;return(0,t.mdx)(p,(0,l.A)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,t.mdx)(o.C,{text:"Examples",to:"hydra/experimental/callbacks.py",mdxType:"ExampleGithubLink"}),(0,t.mdx)("p",null,"The ",(0,t.mdx)(o.A,{to:"hydra/experimental/callback.py",mdxType:"GithubLink"},"Callback interface")," enables custom\ncode to be triggered by various Hydra events."),(0,t.mdx)("p",null,"To use the callback API, one should import Hydra's ",(0,t.mdx)("inlineCode",{parentName:"p"},"Callback")," class:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-python"},"from hydra.experimental.callback import Callback\n")),(0,t.mdx)("p",null,"Users can then create subclasses of this ",(0,t.mdx)("inlineCode",{parentName:"p"},"Callback")," class, overriding one or more of\nthe methods defined by ",(0,t.mdx)("inlineCode",{parentName:"p"},"Callback"),". For the methods of a subclass to be called at the\nappropriate time, the subclass must be registered with Hydra in the ",(0,t.mdx)("inlineCode",{parentName:"p"},"hydra.callbacks")," config\n(see examples below)."),(0,t.mdx)("p",null,"The full API exposed by the ",(0,t.mdx)("inlineCode",{parentName:"p"},"hydra.experimental.callback.Callback")," class is listed below:"),(0,t.mdx)("details",null,(0,t.mdx)("summary",null,"Events supported (Click to expand)"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-python"},'from hydra.types import TaskFunction\n\nclass Callback:\n    def on_run_start(self, config: DictConfig, **kwargs: Any) -> None:\n        """\n        Called in RUN mode before job/application code starts. `config` is composed with overrides.\n        Some `hydra.runtime` configs are not populated yet.\n        See hydra.core.utils.run_job for more info.\n        """\n        ...\n\n    def on_run_end(self, config: DictConfig, **kwargs: Any) -> None:\n        """\n        Called in RUN mode after job/application code returns.\n        """\n        ...\n\n    def on_multirun_start(self, config: DictConfig, **kwargs: Any) -> None:\n        """\n        Called in MULTIRUN mode before any job starts.\n        When using a launcher, this will be executed on local machine before any Sweeper/Launcher is initialized.\n        """\n        ...\n\n    def on_multirun_end(self, config: DictConfig, **kwargs: Any) -> None:\n        """\n        Called in MULTIRUN mode after all jobs returns.\n        When using a launcher, this will be executed on local machine.\n        """\n        ...\n\n    def on_job_start(self, config: DictConfig, *, task_function: TaskFunction, **kwargs: Any) -> None:\n        """\n        Called in both RUN and MULTIRUN modes, once for each Hydra job (before running application code).\n        This is called from within `hydra.core.utils.run_job`. In the case of remote launching, this will be executed\n        on the remote server along with your application code. The `task_function` argument is the function\n        decorated with `@hydra.main`.\n        """\n        ...\n\n    def on_job_end(\n        self, config: DictConfig, job_return: JobReturn, **kwargs: Any\n    ) -> None:\n        """\n        Called in both RUN and MULTIRUN modes, once for each Hydra job (after running\n        application code).\n        This is called from within `hydra.core.utils.run_job`. In the case of remote launching, this will be executed\n        on the remote server after your application code.\n\n        `job_return` contains info that could be useful for logging or post-processing.\n        See hydra.core.utils.JobReturn for more.\n        """\n        ...\n\n    def on_compose_config(\n        self,\n        config: DictConfig,\n        config_name: Optional[str],\n        overrides: List[str],\n    ) -> None:\n        """\n        Called during the compose phase and before the config is returned to the user.\n        config is the composed config with overrides applied.\n        """\n        ...\n'))),(0,t.mdx)("h3",{id:"configure-callback"},"Configure Callback"),(0,t.mdx)("p",null,"Say we have ",(0,t.mdx)("inlineCode",{parentName:"p"},"MyCallback")," so after every job ends we can upload a certain file to a"," ",(0,t.mdx)("a",{parentName:"p",href:"https://internalfb.com/sevmanager/view/3"},"S3")," ","bucket.\nFor simplicity we include this Callback class within the application, in real life you should have the\nCallback in a separate file.\nRunning the application, we can see our custom method ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_job_end")," was called."),(0,t.mdx)("div",{className:"row"},(0,t.mdx)("div",{className:"col col--9"},(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-python",metastring:'title="my_app.py"',title:'"my_app.py"'},'class MyCallback(Callback):\n   def __init__(self, bucket: str, file_path: str) -> None:\n        self.bucket = bucket\n        self.file_path = file_path\n\n   def on_job_end(self, config: DictConfig, **kwargs: Any) -> None:\n        print(f"Job ended,uploading...")\n        # uploading...\n\n@hydra.main(version_base=None, config_path="conf", config_name="config")\ndef my_app(cfg: DictConfig) -> None:\n    print(OmegaConf.to_yaml(cfg))\n\n\nif __name__ == "__main__":\n    my_app()\n'))),(0,t.mdx)("div",{className:"col col--3"},(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-commandline",metastring:'title="output"',title:'"output"'},"\n$ python  my_app.py\nfoo: bar\n\nJob ended,uploading...\n\n\n\n\n\n\n\n\n\n\n\n")))),(0,t.mdx)("p",null,"Now let's take a look at the configurations."),(0,t.mdx)("div",{className:"row"},(0,t.mdx)("div",{className:"col col--4"},(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-commandline",metastring:'title="$ tree conf"',title:'"$',tree:!0,'conf"':!0},"conf\n\u251c\u2500\u2500 config.yaml\n\u2514\u2500\u2500 hydra\n    \u2514\u2500\u2500 callbacks\n        \u2514\u2500\u2500 my_callback.yaml\n\n\n"))),(0,t.mdx)("div",{className:"col  col--3"},(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-commandline",metastring:'title="conf/config.yaml"',title:'"conf/config.yaml"'},"defaults:\n - /hydra/callbacks:\n    - my_callback\n\nfoo: bar\n\n\n"))),(0,t.mdx)("div",{className:"col  col--5"},(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-commandline",metastring:'title="conf/hydra/callbacks/my_callback.yaml"',title:'"conf/hydra/callbacks/my_callback.yaml"'},"# @package _global_\nhydra:\n  callbacks:\n    my_callback:\n      _target_: my_app.MyCallback\n      bucket: my_s3_bucket\n      file_path: ./test.pt\n")))),(0,t.mdx)("h3",{id:"callback-ordering"},"Callback ordering"),(0,t.mdx)("p",null,"The ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_compose_config")," method will be called first, followed by\n",(0,t.mdx)("inlineCode",{parentName:"p"},"on_run_start")," or ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_multirun_start")," method will get called first,\nand then ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_job_start")," (called once for each job).\nAfter each job ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_job_end")," is called, and finally either ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_run_end")," or\n",(0,t.mdx)("inlineCode",{parentName:"p"},"on_multirun_end")," is called one time before the application exits."),(0,t.mdx)("p",null,"When using the ",(0,t.mdx)("inlineCode",{parentName:"p"},"compose")," function directly, only ",(0,t.mdx)("inlineCode",{parentName:"p"},"on_compose_config")," will be called."),(0,t.mdx)("p",null,"In the ",(0,t.mdx)("inlineCode",{parentName:"p"},"hydra.callbacks")," section of your config, you can use a list to register multiple callbacks. They will be called in the final composed order for ",(0,t.mdx)("inlineCode",{parentName:"p"},"start")," events and\nin reversed order for ",(0,t.mdx)("inlineCode",{parentName:"p"},"end")," events. So, for example, suppose we have the following composed config:"),(0,t.mdx)("pre",null,(0,t.mdx)("code",{parentName:"pre",className:"language-commandline",metastring:'title="python my_app.py --cfg hydra -p hydra.callbacks"',title:'"python',"my_app.py":!0,"--cfg":!0,hydra:!0,"-p":!0,'hydra.callbacks"':!0},"# @package hydra.callbacks\nmy_callback1:\n  _target_: my_app.MyCallback1\n  param1: val1\nmy_callback2:\n  _target_: my_app.MyCallback2\n  param2: val2\n")),(0,t.mdx)("p",null,"Before each job starts, ",(0,t.mdx)("inlineCode",{parentName:"p"},"MyCallback1.on_job_start")," will get called first,\nfollowed by ",(0,t.mdx)("inlineCode",{parentName:"p"},"MyCallback2.on_job_start"),".\nAfter each job ends, ",(0,t.mdx)("inlineCode",{parentName:"p"},"MyCallback2.on_job_end")," will get called first,\nfollowed by ",(0,t.mdx)("inlineCode",{parentName:"p"},"MyCallback1.on_job_end"),"."),(0,t.mdx)("h3",{id:"example-callbacks"},"Example callbacks"),(0,t.mdx)("p",null,"We've included some example callbacks  ",(0,t.mdx)(o.A,{to:"hydra/experimental/callbacks.py",mdxType:"GithubLink"},"here"),":"),(0,t.mdx)("ul",null,(0,t.mdx)("li",{parentName:"ul"},(0,t.mdx)("inlineCode",{parentName:"li"},"LogJobReturnCallback")," is especially useful for logging errors when running on a remote cluster (e.g. slurm.)"),(0,t.mdx)("li",{parentName:"ul"},(0,t.mdx)("inlineCode",{parentName:"li"},"PickleJobInfoCallback")," can be used to reproduce a Hydra job. See ",(0,t.mdx)("a",{parentName:"li",href:"/docs/experimental/rerun"},"here")," for more."),(0,t.mdx)("li",{parentName:"ul"},(0,t.mdx)("inlineCode",{parentName:"li"},"LogComposeCallback")," is useful for logging whenever a new config is composed and the overrides and context used.")))}u.isMDXComponent=!0}}]);