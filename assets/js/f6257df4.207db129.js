"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2347],{357:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>r});const i=JSON.parse('{"id":"upgrades/1.0_to_1.1/automatic_schema_matching","title":"Automatic schema-matching","description":"In Hydra 1.0, when a config file is loaded, if a config with a matching name and group is present in the ConfigStore,","source":"@site/versioned_docs/version-1.3/upgrades/1.0_to_1.1/automatic_schema_matching.md","sourceDirName":"upgrades/1.0_to_1.1","slug":"/upgrades/1.0_to_1.1/automatic_schema_matching","permalink":"/docs/1.3/upgrades/1.0_to_1.1/automatic_schema_matching","draft":false,"unlisted":false,"editUrl":"https://github.com/facebookresearch/hydra/edit/main/website/versioned_docs/version-1.3/upgrades/1.0_to_1.1/automatic_schema_matching.md","tags":[],"version":"1.3","lastUpdatedBy":"zhenbang-2026","lastUpdatedAt":1757109332000,"frontMatter":{"id":"automatic_schema_matching","title":"Automatic schema-matching","hide_title":true},"sidebar":"docs","previous":{"title":"Changes to Package Header","permalink":"/docs/1.3/upgrades/1.0_to_1.1/changes_to_package_header"},"next":{"title":"Config path changes","permalink":"/docs/1.3/upgrades/0.11_to_1.0/config_path_changes"}}');var t=s(74848),o=s(28453);const a={id:"automatic_schema_matching",title:"Automatic schema-matching",hide_title:!0},c=void 0,l={},r=[{value:"Migration",id:"migration",level:2},{value:"Option 1: rename the Structured Config",id:"option-1-rename-the-structured-config",level:3},{value:"Hydra 1.0",id:"hydra-10",level:4},{value:"Hydra 1.1",id:"hydra-11",level:4},{value:"Option 2: rename the config file",id:"option-2-rename-the-config-file",level:3},{value:"Hydra 1.0",id:"hydra-10-1",level:4},{value:"Hydra 1.1",id:"hydra-11-1",level:4}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["In Hydra 1.0, when a config file is loaded, if a config with a matching name and group is present in the ",(0,t.jsx)(n.code,{children:"ConfigStore"}),",\nit is used as the schema for the newly loaded config."]}),"\n",(0,t.jsx)(n.p,{children:"There are several problems with this approach:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Inflexible"}),": This approach can only be used when a schema should validate a single config file.\nIt does not work if you want to use the same schema to validate multiple config files."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unexpected"}),": This behavior can be unexpected. There is no way to tell this is going to happen when looking at a given\nconfig file."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Hydra 1.1 deprecates this behavior in favor of an explicit config extension via the Defaults List.\nThis upgrade page aims to provide a summary of the required changes. It is highly recommended that you read the following pages:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/1.3/advanced/defaults_list",children:"Background: The Defaults List"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/1.3/patterns/extending_configs",children:"Background: Extending configs"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/1.3/tutorials/structured_config/schema",children:"Tutorial: Structured config schema"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"migration",children:"Migration"}),"\n",(0,t.jsxs)(n.p,{children:["Before the upgrade, you have two different configs with the same name (a config file, and a Structured Config in the ",(0,t.jsx)(n.code,{children:"ConfigStore"}),").\nYou need to rename one of them. Depending on the circumstances and your preference you may rename one or the other."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If you control both configs, you can rename either of them."}),"\n",(0,t.jsx)(n.li,{children:"If you only control the config file, rename it."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"option-1-rename-the-structured-config",children:"Option 1: rename the Structured Config"}),"\n",(0,t.jsx)(n.p,{children:"This option is less disruptive. Use it if you control the Structured Config."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Use a different name when storing the schema into the Config Store. Common choices:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"base_"})," prefix, e.g. ",(0,t.jsx)(n.code,{children:"base_mysql"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"_schema"})," suffix, e.g. ",(0,t.jsx)(n.code,{children:"mysql_schema"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Add the schema to the Defaults List of the extending config file."}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Click to show an example"}),(0,t.jsx)(n.h4,{id:"hydra-10",children:"Hydra 1.0"}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="db/mysql.yaml"',children:"# @package _group_\nhost: localhost\nport: 3306\n\n\n\n\n\n\n"})})}),(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="db/mysql schema in the ConfigStore"',children:'@dataclass\nclass MySQLConfig:\n    host: str\n    port: int\n\ncs = ConfigStore.instance()\ncs.store(group="db",\n        name="mysql",\n        node=MySQLConfig)\n'})})})]}),(0,t.jsx)(n.h4,{id:"hydra-11",children:"Hydra 1.1"}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="db/mysql.yaml" {1,2}',children:"defaults:\n  - base_mysql\n\nhost: localhost\nport: 3306\n\n\n\n\n"})})}),(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="db/mysql schema in the ConfigStore" {8}',children:'@dataclass\nclass MySQLConfig:\n    host: str\n    port: int\n\ncs = ConfigStore.instance()\ncs.store(group="db",\n        name="base_mysql",\n        node=MySQLConfig)\n'})})})]})]}),"\n",(0,t.jsx)(n.h3,{id:"option-2-rename-the-config-file",children:"Option 2: rename the config file"}),"\n",(0,t.jsx)(n.p,{children:"This option is a bit more disruptive. Use it if you only control the config file."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Rename the config file. Common choices are ",(0,t.jsx)(n.code,{children:"custom_"})," or ",(0,t.jsx)(n.code,{children:"my_"})," prefix, e.g. ",(0,t.jsx)(n.code,{children:"custom_mysql.yaml"}),". You can also use a domain specific name like ",(0,t.jsx)(n.code,{children:"prod_mysql.yaml"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Add the schema to the Defaults List of the extending config file."}),"\n",(0,t.jsxs)(n.li,{children:["Update references to the config name accordingly, e.g. on the command-line ",(0,t.jsx)(n.code,{children:"db=mysql"})," would become ",(0,t.jsx)(n.code,{children:"db=custom_mysql"}),", and in a defaults list ",(0,t.jsx)(n.code,{children:"db: mysql"})," would become ",(0,t.jsx)(n.code,{children:"db: custom_mysql"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s,{children:[(0,t.jsx)("summary",{children:"Click to show an example"}),(0,t.jsx)(n.h4,{id:"hydra-10-1",children:"Hydra 1.0"}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("div",{className:"col col--6",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="db/mysql.yaml"',children:"# @package _group_\nhost: localhost\nport: 3306\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:"defaults:\n  - db: mysql\n"})})]}),(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="db/mysql schema in the ConfigStore"',children:'@dataclass\nclass MySQLConfig:\n    host: str\n    port: int\n\ncs = ConfigStore.instance()\ncs.store(group="db",\n        name="mysql",\n        node=MySQLConfig)\n\n'})})})]}),(0,t.jsx)(n.h4,{id:"hydra-11-1",children:"Hydra 1.1"}),(0,t.jsxs)(n.p,{children:["Rename ",(0,t.jsx)(n.code,{children:"db/mysql.yaml"})," to ",(0,t.jsx)(n.code,{children:"db/custom_mysql.yaml"})," and explicitly add the schema to the Defaults List."]}),(0,t.jsxs)("div",{className:"row",children:[(0,t.jsxs)("div",{className:"col col--6",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="db/custom_mysql.yaml" {1,2}',children:"defaults:\n  - mysql\n\nhost: localhost\nport: 3306\n"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml" {2}',children:"defaults:\n  - db: custom_mysql\n"})})]}),(0,t.jsx)("div",{className:"col col--6",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="db/mysql schema in the ConfigStore"',children:"\n\n\n\n\n                  NO CHANGES\n\n\n\n\n\n\n"})})})]}),(0,t.jsxs)(n.p,{children:["Don't forget to also update your command line overrides from ",(0,t.jsx)(n.code,{children:"db=mysql"})," to ",(0,t.jsx)(n.code,{children:"db=custom_mysql"}),"."]})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var i=s(96540);const t={},o=i.createContext(t);function a(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);