"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9107],{10524:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"plugins/nevergrad_sweeper","title":"Nevergrad Sweeper plugin","description":"PyPI","source":"@site/versioned_docs/version-1.1/plugins/nevergrad_sweeper.md","sourceDirName":"plugins","slug":"/plugins/nevergrad_sweeper","permalink":"/docs/1.1/plugins/nevergrad_sweeper","draft":false,"unlisted":false,"editUrl":"https://github.com/facebookresearch/hydra/edit/main/website/versioned_docs/version-1.1/plugins/nevergrad_sweeper.md","tags":[],"version":"1.1","lastUpdatedBy":"Ryan Soklaski","lastUpdatedAt":1761323009000,"frontMatter":{"id":"nevergrad_sweeper","title":"Nevergrad Sweeper plugin","sidebar_label":"Nevergrad Sweeper plugin"},"sidebar":"docs","previous":{"title":"Ax Sweeper plugin","permalink":"/docs/1.1/plugins/ax_sweeper"},"next":{"title":"Optuna Sweeper plugin","permalink":"/docs/1.1/plugins/optuna_sweeper"}}');var a=n(74848),s=n(28453),t=n(49595);const d={id:"nevergrad_sweeper",title:"Nevergrad Sweeper plugin",sidebar_label:"Nevergrad Sweeper plugin"},o=void 0,l={},c=[{value:"Installation",id:"installation",level:3},{value:"Usage",id:"usage",level:3},{value:"Example of training using Nevergrad hyperparameter search",id:"example-of-training-using-nevergrad-hyperparameter-search",level:2},{value:"Defining the parameters",id:"defining-the-parameters",level:2},{value:"Defining through commandline override",id:"defining-through-commandline-override",level:3},{value:"Choices",id:"choices",level:4},{value:"Scalar",id:"scalar",level:4},{value:"Defining through config file",id:"defining-through-config-file",level:3},{value:"Choices",id:"choices-1",level:4},{value:"Scalars",id:"scalars",level:4}];function h(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.a,{href:"https://pypi.org/project/hydra-nevergrad-sweeper/",children:(0,a.jsx)(r.img,{src:"https://img.shields.io/pypi/v/hydra-nevergrad-sweeper",alt:"PyPI"})}),"\n",(0,a.jsx)(r.img,{src:"https://img.shields.io/pypi/l/hydra-nevergrad-sweeper",alt:"PyPI - License"}),"\n",(0,a.jsx)(r.img,{src:"https://img.shields.io/pypi/pyversions/hydra-nevergrad-sweeper",alt:"PyPI - Python Version"}),"\n",(0,a.jsx)(r.a,{href:"https://pypistats.org/packages/hydra-nevergrad-sweeper",children:(0,a.jsx)(r.img,{src:"https://img.shields.io/pypi/dm/hydra-nevergrad-sweeper.svg",alt:"PyPI - Downloads"})}),(0,a.jsx)(t.C,{text:"Example application",to:"plugins/hydra_nevergrad_sweeper/example"}),(0,a.jsx)(t.C,{text:"Plugin source",to:"plugins/hydra_nevergrad_sweeper"})]}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.a,{href:"https://facebookresearch.github.io/nevergrad/",children:"Nevergrad"})," is a derivative-free optimization platform providing a library of state-of-the-art algorithms for hyperparameter search. This plugin provides Hydra applications a mechanism to use ",(0,a.jsx)(r.a,{href:"https://facebookresearch.github.io/nevergrad/",children:"Nevergrad"})," algorithms to optimize experiment/application parameters."]}),"\n",(0,a.jsx)(r.h3,{id:"installation",children:"Installation"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-commandline",children:"pip install hydra-nevergrad-sweeper --upgrade\n"})}),"\n",(0,a.jsx)(r.h3,{id:"usage",children:"Usage"}),"\n",(0,a.jsxs)(r.p,{children:["Once installed, add ",(0,a.jsx)(r.code,{children:"hydra/sweeper=nevergrad"})," to your command. Alternatively, override ",(0,a.jsx)(r.code,{children:"hydra/sweeper"})," in your config:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:"defaults:\n  - override hydra/sweeper: nevergrad\n"})}),"\n",(0,a.jsxs)(r.p,{children:["The default configuration is ",(0,a.jsx)(t.A,{to:"plugins/hydra_nevergrad_sweeper/hydra_plugins/hydra_nevergrad_sweeper/config.py",children:"here"}),".\nThere are several standard approaches for configuring plugins. Check ",(0,a.jsx)(r.a,{href:"/docs/1.1/patterns/configuring_plugins",children:"this page"})," for more information."]}),"\n",(0,a.jsx)(r.h2,{id:"example-of-training-using-nevergrad-hyperparameter-search",children:"Example of training using Nevergrad hyperparameter search"}),"\n",(0,a.jsxs)(r.p,{children:["We include an example of how to use this plugin. The file ",(0,a.jsx)(t.A,{to:"plugins/hydra_nevergrad_sweeper/example/my_app.py",children:"example/my_app.py"})," implements an example of minimizing a (dummy) function using a mixture of continuous and discrete parameters."]}),"\n",(0,a.jsx)(r.p,{children:"You can discover the Nevergrad sweeper parameters with:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",metastring:'title="$ python your_app hydra/sweeper=nevergrad --cfg hydra -p hydra.sweeper"',children:"# @package hydra.sweeper\n_target_: hydra_plugins.hydra_nevergrad_sweeper.core.NevergradSweeper\noptim:\n  optimizer: NGOpt\n  budget: 80\n  num_workers: 10\n  noisy: false\n  maximize: false\n  seed: null\nparametrization: {}\nversion: 1\n"})}),"\n",(0,a.jsxs)(r.p,{children:["The function decorated with ",(0,a.jsx)(r.code,{children:"@hydra.main()"})," returns a float which we want to minimize, the minimum is 0 and reached for:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:"db: mnist\nlr: 0.12\ndropout: 0.33\nbatch_size=4\n"})}),"\n",(0,a.jsxs)(r.p,{children:["To run hyperparameter search and look for the best parameters for this function, clone the code and run the following command in the ",(0,a.jsx)(r.code,{children:"plugins/hydra_nevergrad_sweeper"})," directory:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"python example/my_app.py -m\n"})}),"\n",(0,a.jsx)(r.p,{children:"You can also override the search space parametrization:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"python example/my_app.py --multirun db=mnist,cifar batch_size=4,8,16 \\\n'lr=tag(log, interval(0.001, 1))' 'dropout=interval(0,1)'\n"})}),"\n",(0,a.jsx)(r.p,{children:"The initialization of the sweep and the first 5 evaluations (out of 100) look like this:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-text",children:"[2020-10-08 20:13:53,592][HYDRA] NevergradSweeper(optimizer=NGOpt, budget=100, num_workers=10) minimization\n[2020-10-08 20:13:53,593][HYDRA] with parametrization Dict(batch_size=Choice(choices=Tuple(4,8,16),weights=Array{(1,3)}),db=Choice(choices=Tuple(mnist,cifar),weights=Array{(1,2)}),dropout=Scalar{Cl(0,1,b)}[sigma=Log{exp=2.0}],lr=Log{exp=3.162277660168379,Cl(0.001,1,b)}):{'db': 'mnist', 'lr': 0.03162277660168379, 'dropout': 0.5, 'batch_size': 8}\n[2020-10-08 20:13:53,593][HYDRA] Sweep output dir: multirun/2020-10-08/20-13-53\n[2020-10-08 20:13:55,023][HYDRA] Launching 10 jobs locally\n[2020-10-08 20:13:55,023][HYDRA]        #0 : db=mnist lr=0.03162277660168379 dropout=0.5 batch_size=16\n[2020-10-08 20:13:55,217][__main__][INFO] - dummy_training(dropout=0.500, lr=0.032, db=mnist, batch_size=16) = 13.258\n[2020-10-08 20:13:55,218][HYDRA]        #1 : db=cifar lr=0.018178519762066934 dropout=0.5061074452336254 batch_size=4\n[2020-10-08 20:13:55,408][__main__][INFO] - dummy_training(dropout=0.506, lr=0.018, db=cifar, batch_size=4) = 0.278\n[2020-10-08 20:13:55,409][HYDRA]        #2 : db=cifar lr=0.10056825918734161 dropout=0.6399687427725211 batch_size=4\n[2020-10-08 20:13:55,595][__main__][INFO] - dummy_training(dropout=0.640, lr=0.101, db=cifar, batch_size=4) = 0.329\n[2020-10-08 20:13:55,596][HYDRA]        #3 : db=mnist lr=0.06617542958182834 dropout=0.5059497416026679 batch_size=8\n[2020-10-08 20:13:55,812][__main__][INFO] - dummy_training(dropout=0.506, lr=0.066, db=mnist, batch_size=8) = 5.230\n[2020-10-08 20:13:55,813][HYDRA]        #4 : db=mnist lr=0.16717013388679514 dropout=0.6519070394318255 batch_size=4\n...\n[2020-10-08 20:14:27,988][HYDRA] Best parameters: db=cifar lr=0.11961221693764439 dropout=0.37285878409770895 batch_size=4\n"})}),"\n",(0,a.jsx)(r.p,{children:"and the final 2 evaluations look like this:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-text",children:"[HYDRA] \t#8 : db=mnist batch_size=4 lr=0.094 dropout=0.381\n[__main__][INFO] - my_app.py(dropout=0.381, lr=0.094, db=mnist, batch_size=4) = 1.077\n[HYDRA] \t#9 : db=mnist batch_size=4 lr=0.094 dropout=0.381\n[__main__][INFO] - my_app.py(dropout=0.381, lr=0.094, db=mnist, batch_size=4) = 1.077\n[HYDRA] Best parameters: db=mnist batch_size=4 lr=0.094 dropout=0.381\n"})}),"\n",(0,a.jsxs)(r.p,{children:["The run also creates an ",(0,a.jsx)(r.code,{children:"optimization_results.yaml"})," file in your sweep folder with the parameters recommended by the optimizer:"]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:"best_evaluated_result: 0.381\n\nbest_evaluated_params:\n  batch_size: 4\n  db: mnist\n  dropout: 0.381\n  lr: 0.094\n\nname: nevergrad\n"})}),"\n",(0,a.jsx)(r.h2,{id:"defining-the-parameters",children:"Defining the parameters"}),"\n",(0,a.jsxs)(r.p,{children:["The plugin supports two types of parameters: ",(0,a.jsx)(r.a,{href:"https://facebookresearch.github.io/nevergrad/parametrization_ref.html#nevergrad.p.Choice",children:"Choices"})," and ",(0,a.jsx)(r.a,{href:"https://facebookresearch.github.io/nevergrad/parametrization_ref.html#nevergrad.p.Scalar",children:"Scalars"}),". They can be defined either through config file or commandline override."]}),"\n",(0,a.jsx)(r.h3,{id:"defining-through-commandline-override",children:"Defining through commandline override"}),"\n",(0,a.jsxs)(r.p,{children:["Hydra provides an override parser that supports rich syntax. More documentation can be found in (",(0,a.jsx)(r.a,{href:"/docs/1.1/advanced/override_grammar/basic",children:"OverrideGrammer/Basic"}),") and (",(0,a.jsx)(r.a,{href:"/docs/1.1/advanced/override_grammar/extended",children:"OverrideGrammer/Extended"}),"). We recommend you go through them first before proceeding with this doc."]}),"\n",(0,a.jsx)(r.h4,{id:"choices",children:"Choices"}),"\n",(0,a.jsx)(r.p,{children:"To override a field with choices:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-commandline",children:"'key=1,5'\n'key=shuffle(range(1, 8))'\n'key=range(1,5)'\n"})}),"\n",(0,a.jsxs)(r.p,{children:["You can tag an override with ",(0,a.jsx)(r.code,{children:"ordered"})," to indicate it's a ",(0,a.jsx)(r.a,{href:"https://facebookresearch.github.io/nevergrad/parametrization_ref.html#nevergrad.p.TransitionChoice",children:(0,a.jsx)(r.code,{children:"TransitionChoice"})})]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-commandline",children:"`key=tag(ordered, choice(1,2,3))`\n"})}),"\n",(0,a.jsx)(r.h4,{id:"scalar",children:"Scalar"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-commandline",children:"`key=interval(1,12)`             # Interval are float by default\n`key=int(interval(1,8))`         # Scalar bounds cast to an int\n`key=tag(log, interval(1,12))`   # call ng.p.Log if tagged with log\n"})}),"\n",(0,a.jsx)(r.h3,{id:"defining-through-config-file",children:"Defining through config file"}),"\n",(0,a.jsx)(r.h4,{id:"choices-1",children:"Choices"}),"\n",(0,a.jsx)(r.p,{children:"Choices are defined with a list in a config file."}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:"db:\n  - mnist\n  - cifar\n"})}),"\n",(0,a.jsx)(r.h4,{id:"scalars",children:"Scalars"}),"\n",(0,a.jsx)(r.p,{children:"Scalars can be defined in config files, with fields:"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"init"}),": optional initial value"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"lower"})," : optional lower bound"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"upper"}),": optional upper bound"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"log"}),": set to ",(0,a.jsx)(r.code,{children:"true"})," for log distributed values"]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"step"}),": optional step size for looking for better parameters. In linear mode, this is an additive step; in logarithmic mode it is multiplicative."]}),"\n",(0,a.jsxs)(r.li,{children:[(0,a.jsx)(r.code,{children:"integer"}),": set to ",(0,a.jsx)(r.code,{children:"true"})," for integers (favor floats over integers whenever possible)"]}),"\n"]}),"\n",(0,a.jsxs)(r.p,{children:["Providing only ",(0,a.jsx)(r.code,{children:"lower"})," and ",(0,a.jsx)(r.code,{children:"upper"})," bound will set the initial value to the middle of the range and the step to a sixth of the range.\n",(0,a.jsx)(r.strong,{children:"Note"}),": unbounded scalars (scalars with no upper and/or lower bounds) can only be defined through a config file."]})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},28453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>d});var i=n(96540);const a={},s=i.createContext(a);function t(e){const r=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function d(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(s.Provider,{value:r},e.children)}},49595:(e,r,n)=>{n.d(r,{A:()=>o,C:()=>l});n(96540);var i=n(28774),a=n(44586),s=n(48295),t=n(74848);function d(e){const r=(0,s.ir)();return(0,a.default)().siteConfig.customFields.githubLinkVersionToBaseUrl[r?.name??"current"]+e}function o(e){return(0,t.jsx)(i.default,{...e,to:d(e.to),target:"_blank"})}function l(e){const r=e.text??"Example (Click Here)";return(0,t.jsxs)(o,{...e,children:[(0,t.jsx)("span",{children:"\xa0"}),(0,t.jsx)("img",{src:"https://img.shields.io/badge/-"+r+"-informational",alt:"Example (Click Here)"})]})}}}]);